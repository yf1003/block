System.register([],(function(e,t){"use strict";var n,i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function l(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}s((i=i.apply(e,t||[])).next())}))};t&&t.id;function o(e=1e3){return i(this,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}))}return{setters:[],execute:function(){e("ControlsGUI",n=class e{static watchConfigs(t){return i(this,void 0,void 0,(function*(){yield function(e,t){return i(this,void 0,void 0,(function*(){for(;null==window[e];)yield o(t);return window[e]}))}("cc",10),e.waitForConfigs(t)}))}static waitForConfigs(t){var n;n=n=>{new e(t).createControls(n)},cc.game.once("ControlsObject",(e=>n(e)))}constructor(e=!1){this.gui=new guify({align:"right",opacity:.95,width:"400px",open:e,copyInitialValue:function(e){return null!=e&&"object"==typeof e?Array.isArray(e)?Array.from(e):"clone"in e?e.clone():Object.assign({},e):e}})}createControls(t){if(console.log("Controls init, then you can use controls in the console to print the controls object."),this.gui.Register({type:"button",label:"Save",action:()=>{const e=t.getSaveData();null!=e?t.saveData(JSON.stringify(e)):t.clearData()}}),this.gui.Register({type:"button",label:"Clear Storage",action:()=>t.clearData()}),this.gui.Register({type:"button",label:"Export Storage Json",action:()=>{const e=t.getSaveData();if(null==e)return this.gui.Toast("No data to export",3e3,250);const n=new Date(Date.now()),i=`controls_${n.getHours()}-${n.getMinutes()}.json`,o=new Blob([JSON.stringify(e)],{type:"text/plain"}),r=URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download=i,l.click()}}),!CC_BUILD){const e=function(t,n,i){for(const o of Object.keys(n)){const r=n[o];r instanceof Object&&!Array.isArray(r)?e(t,r,i+o+"."):t.push(i+o)}return t},n='import { ControlsManager } from "framework/config/ControlsManager";\n\nconst properties = %code%;\n\nconst initialize = ControlsManager.initialize;\nControlsManager.initialize = function (...args: any[]) {\n    const visible = false;\n    const setPropertyVisible = function (property: string, parent: | { visible: boolean }) {\n        const keys = property.split(".");\n        for (const key of keys) {\n            if (parent[key] == null)\n                return console.log("找不到该属性:", property, key);\n            if (parent[key].type == "group")\n                parent = parent[key].value.getPropertiesDescriptor();\n            else\n                parent = parent[key];\n        }\n        parent.visible = visible;\n    }\n\n    for (const property of properties)\n        setPropertyVisible(property, ControlsManager.propertiesDesc as any)\n    initialize(...args);\n};';this.gui.Register({type:"button",label:"Export Properties Script",action:()=>{const i=t.getSaveData();if(null==i)return this.gui.Toast("No data to export",3e3,250);const o=e([],i,""),r=n.replace("%code%",JSON.stringify(o)),l=new Blob([r],{type:"text/plain"}),a=URL.createObjectURL(l),s=document.createElement("a");s.href=a,s.download="ControlsDisplayProperties.ts",s.click()}})}e.addObjectAllProperties(this.gui,void 0,t),cc.game.on("ControlsAddProperties",((t,n,i)=>e.addObjectProperties(this.gui,void 0,t,n,i)))}static getValueType(e,t){if(null!=t.options)return Array.isArray(e)?"checkbox":"radio";switch(typeof e){case"number":return"slider";case"boolean":return"switch";case"string":return"input";case"function":return"button";case"object":if(Array.isArray(e)&&2==e.length&&"number"==typeof e[0]&&"number"==typeof e[1])return"interval";if(e instanceof cc.Vec2)return"vector2";if(e instanceof cc.Vec3)return"vector3";if(e instanceof cc.Vec4)return"vector4";if(e instanceof cc.Color)return"color-picker";default:return null}}static getNumberRange(e){var t,n,i,o;const r=null!==(t=e.range)&&void 0!==t?t:[];return{min:null!==(n=e.min)&&void 0!==n?n:r[0],max:null!==(i=e.max)&&void 0!==i?i:r[1],step:null!==(o=e.step)&&void 0!==o?o:r[2]}}static addObjectAllProperties(t,n,i){const o=i.getPropertiesDescriptor(),r=Object.keys(o);e.addObjectProperties(t,n,i,r,o)}static addObjectProperties(t,n,i,o,r){for(const l of o)e.addObjectProperty(t,n,i,l,r[l])}static addObjectProperty(t,n,i,o,r){var l,a;r.type=null!==(l=r.type)&&void 0!==l?l:e.getValueType(i[o],r),r.title=null!==(a=r.title)&&void 0!==a?a:o,null==n&&"group"==r.type&&t.Register({type:"title",label:r.title,open:r.isOpen}),e.addProperty(t,n,r,i,o,(e=>{var t;return null===(t=r.onPropertyChange)||void 0===t?void 0:t.call(r,e)}))}static addProperty(t,n,i,o,r,l){var a,s;if(null==i.visible||i.visible)switch(i.type){case"none":console.log("ControlsGUI.addProperty:",i.title,"is none");break;case"display":t.Register({type:"display",label:i.title,initial:i.initial,folder:n,object:o,property:r});break;case"slider":{const a=e.getNumberRange(i);if(i.radian){const e={[r]:o[r]/Math.PI*180},s="number"==typeof i.initial?i.initial/Math.PI*180:void 0;t.Register({type:"range",label:i.title,min:a.min,max:a.max,step:a.step,folder:n,object:e,property:r,initial:s,onChange:t=>{o[r]=e[r]*Math.PI/180,null==l||l(o[r])}})}else t.Register({type:"range",label:i.title,min:a.min,max:a.max,step:a.step,folder:n,object:o,property:r,initial:i.initial,onChange:l});break}case"interval":{const a=e.getNumberRange(i);t.Register({type:"interval",label:i.title,min:a.min,max:a.max,step:a.step,folder:n,object:o,property:r,initial:i.initial,onChange:l});break}case"input":t.Register({type:"text",label:i.title,listenMode:"change",folder:n,object:o,property:r,initial:i.initial,onChange:l});break;case"switch":t.Register({type:"checkbox",label:i.title,folder:n,object:o,property:r,initial:i.initial,onChange:l});break;case"radio":if(Array.isArray(i.options))t.Register({type:"select",label:i.title,options:i.options,folder:n,object:o,property:r,initial:i.initial,onChange:l});else{const e=Object.keys(i.options),a=e.findIndex((e=>i.options[e]==o[r])),s={[r]:e[a]},c=null!=i.initial?e[i.initial]:void 0;t.Register({type:"select",label:i.title,options:e,folder:n,object:s,property:r,initial:c,onChange:e=>{o[r]=i.options[e],null==l||l(o[r])}})}break;case"color-picker":if("string"==typeof o[r]){i.value=i.value.toLowerCase();const e="string"==typeof i.initial?i.initial.toLowerCase():i.initial;t.Register({type:"color",label:i.title,format:"hex",folder:n,object:o,property:r,initial:e,onChange:l})}else{const e=new cc.Color(o[r]),a=Object.defineProperty({},r,{get:function(){return"#"+e.toHEX()},set:function(t){o[r]=e.fromHEX(t)}});let s;null!=i.initial&&(s="#"+i.initial.toHEX()),t.Register({type:"color",label:i.title,format:"hex",folder:n,object:a,property:r,initial:s,onChange:t=>{null!=l&&l(e.fromHEX(t))}})}break;case"checkbox":e.createMultiCheckbox(t,n,i,o,r,l);break;case"button":t.Register({folder:n,type:"button",label:i.title,action:function(){var e;null===(e=o[r])||void 0===e||e.call(o),null==l||l(o)}});break;case"file":t.Register({folder:n,type:"file",accept:i.fileExt,label:i.title,fileReadFunc:null!==(a=i.fileReadFunc)&&void 0!==a?a:"readAsArrayBuffer",onChange:function(e){var t;null===(t=o[r])||void 0===t||t.call(o,e),null==l||l(e)}});break;case"vector2":case"vector3":case"vector4":{const a=null!=n?`${n}.${r}`:r;t.Register({type:"folder",folderName:a,label:i.title,folder:n,open:!0}),console.assert(null!=o[r],o[r],o,r);const s=o[r].clone(),c=i.initial,p=Object.keys(s);for(const n of p){const p=e.getNumberRange(i),u=null!=c?c[n]:void 0;if(null!=p.min||null!=p.max)t.Register({type:"range",label:n,min:p.min,max:p.max,step:p.step,folder:a,object:s,property:n,initial:u,onChange:function(){o[r]=s,null==l||l(s)}});else{const e=t.Register({type:"text",label:n,folder:a,object:s,property:n,initial:u,listenMode:"change",onChange:function(t){s[n]=parseFloat(t),e.label=`${s[n]}`,o[r]=s,null==l||l(s)}})}}break}case"group":{const l=null!=n?`${n}.${r}`:r;t.Register({type:"folder",folder:n,label:i.title,folderName:l,open:null!==(s=i.isOpen)&&void 0!==s&&s}),e.addObjectAllProperties(t,l,o[r]);break}default:return void console.log("can not serialze ",null!=n?`${n}.${r}`:r,i)}}static createMultiCheckbox(e,t,n,i,o,r){var l,a;const s=`${t}.${o}`,c=e.Register({type:"folder",folderName:s,label:n.title,folder:t,open:!0});let p;if(Array.isArray(n.options)){const t=i[o],a=null!==(l=n.initial)&&void 0!==l?l:[];for(const i of n.options)e.Register({type:"checkbox",label:i,folder:s,initial:-1!=a.indexOf(i),isChecked:-1!=t.indexOf(i),onChange:e=>{e?-1==t.indexOf(i)&&t.push(i):-1!=(p=t.indexOf(i))&&t.splice(p,1),null==r||r(t)}})}else{const t=i[o],l=Object.keys(n.options),c=null!==(a=n.initial)&&void 0!==a?a:[];for(let i=0;i<l.length;i++){const o=l[i],a=n.options[o];e.Register({type:"checkbox",label:o,folder:s,initial:-1!=c.indexOf(a),isChecked:-1!=t.indexOf(a),onChange:e=>{e?-1==t.indexOf(a)&&t.push(a):-1!=(p=t.indexOf(a))&&t.splice(p,1),null==r||r(t)}})}}return c}}),n.watchConfigs(!1)}}}));