"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("fs")),n=require("path"),l=require("../../config");function o(e,t,n,l,o){const i=document.createElement("label"),s=document.createElement("input");return e.appendChild(i),e.appendChild(s),i.className=t,s.value=i.textContent=l,s.style.display="none",i.addEventListener("dblclick",(function(){i.style.display="none",s.style.display="inline",s.focus()})),s.addEventListener("blur",(()=>{null!=s.value&&""!=s.value||(s.value=n),i.textContent=s.value,s.style.display="none",i.style.display="inline",o(i.textContent)})),i}function i(e,t,n,l,i){var s;const a=e.ownerDocument.createElement("input");e.appendChild(a),a.type="radio",a.name=t,a.id=l.value,a.value=null!==(s=l.displayName)&&void 0!==s?s:l.value,a.checked=n,a.addEventListener("click",i);o(e,"option",l.value,a.value,(e=>{l.displayName=e})).htmlFor=a.id}function s(e,t,n){var l;const s=e.ownerDocument,a=s.createElement("hr");e.appendChild(a),o(e,"preset",t,null!==(l=n.displayName)&&void 0!==l?l:t,(e=>{n.displayName=e}));const d=s.createElement("br");e.appendChild(d);for(const l of n.options)i(e,t,n.value==l.value,l,(()=>{n.value=l.value}))}let a;module.exports=Editor.Panel.define({listeners:{show(){console.log("presets panel show")},hide(){console.log("presets panel hide")}},template:t.default.readFileSync((0,n.join)(__dirname,"../../../static/template/default/index.html"),{encoding:"utf8"}),style:t.default.readFileSync((0,n.join)(__dirname,"../../../static/style/default/index.css"),{encoding:"utf8"}),$:{app:"#app",content:"#content"},methods:{},async ready(){if(null==this.$.content)return;const e=this.$.content.ownerDocument,n=await Editor.Message.request(l.PRESET_PACKAGE_NAME,"get-config-path");if(null==n){const t=e.createElement("Label");return t.textContent="加载Preset Config失败",void this.$.content.appendChild(t)}if(!t.default.existsSync(n))return;const o=t.default.readFileSync(n,{encoding:"utf8"});if(null==o)return;a=JSON.parse(o);const i=e.createElement("button");this.$.content.appendChild(i),i.textContent="重置所有配置并关闭面板",i.addEventListener("click",(()=>{var e;for(const t of Object.values(a.presets)){t.displayName=void 0,t.value=null===(e=t.options[0])||void 0===e?void 0:e.value;for(const e of t.options)e.displayName=void 0}Editor.Message.send(l.PRESET_PACKAGE_NAME,"save-preset-config",a),a=null,Editor.Profile.removeConfig(l.PRESET_PACKAGE_NAME,l.PRESET_CONFIG_DATA,"local"),Editor.Panel.close(l.PRESET_PACKAGE_NAME)}));for(const e of Object.entries(a.presets))s(this.$.content,e[0],e[1])},beforeClose(){null!=a&&(Editor.Profile.setConfig(l.PRESET_PACKAGE_NAME,l.PRESET_CONFIG_DATA,JSON.stringify(a.presets),"local"),Editor.Message.send(l.PRESET_PACKAGE_NAME,"save-preset-config",a))},close(){}});