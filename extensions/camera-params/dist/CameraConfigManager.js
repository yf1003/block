"use strict";let e={$:{cameraSelect:".camera-select",cameraInput:".camera-input",cameraDelButton:".camera-del",cameraCreateButton:".camera-create",cameraSaveButton:".camera-save",adaptSaveButton:".adapt-save",addEventLabel:".addEvent"},template:'\n    <section class="CameraConfigManager">\n        <ui-prop no-label>\n            <ui-button slot="content" class="adapt-save">Save Adapt</ui-button>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Camera Selected" tooltip="请选择一个相机名称"></ui-label>\n            <ui-select slot="content" class="camera-select"></ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Camera Name" tooltip="请输入一个相机名称"></ui-label>\n                <ui-input slot="content" class="camera-input">\n                    <ui-button slot="suffix" type="icon" class="camera-del">\n                         <ui-icon value="del"></ui-icon>\n                    </ui-button>\n                    <ui-button slot="suffix" type="icon" class="camera-create">\n                        <ui-icon value="add-more"></ui-icon>\n                    </ui-button>\n                    <ui-button slot="suffix" type="icon" class="camera-save">\n                        <ui-icon value="save"></ui-icon>\n                    </ui-button>\n                </ui-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="false" class="addEvent" style="display:none"></ui-label>\n        </ui-prop>\n    </section>',methods:{},style:'\n        .addEvent {\n            display: "none"\n        }\n        ',async update(e){var a;const t=function(e,a,t,n,r){Editor.Message.send("scene","set-property",{uuid:e.uuid.value,path:`__comps__.${a}.${t}`,dump:{type:n,value:r}})},n=async function(e,a){let t=e.__comps__.find((e=>"OrbitFollowTarget"==e.type));return null==t||-1==t?null:{name:a,polarAngle:t.value.polarAngle.value,azimuthAngle:t.value.azimuthAngle.value,radialDistance:t.value.radialDistance.value,viewOffsetX:t.value._viewOffset.value.x,viewOffsetY:t.value._viewOffset.value.y,viewOffsetZ:t.value._viewOffset.value.z,dampingFactor:t.value.dampingFactor.value}},r=async function(e){let a="",t=e;do{""!=a&&(a="/"+a),a=t.name.value+a,t=await Editor.Message.request("scene","query-node",t.parent.value.uuid)}while(null!=t&&"cc.Node"==t.__type__);return a};let i=await Editor.Message.request("camera-params","getConfigData");const l=null!==(a=i.orbitParams)&&void 0!==a?a:[];let u=e.value;const o=e=>{var a;let t="";for(let n of e)t+=`<option value="${n.name}">${null!==(a=n.displayName)&&void 0!==a?a:n.name}</option>`;this.$.cameraSelect.innerHTML=t};o(l),this.$.cameraInput.value=this.$.cameraSelect.value=u.curCameraParamName.value,"true"!=this.$.addEventLabel.value&&(this.$.addEventLabel.value="true",this.$.cameraSelect.addEventListener("change",(async a=>{const n=this.$.cameraInput.value=u.curCameraParamName.value=a.target.value;let r={uuid:e.value.node.value.uuid,path:e.path,dump:e};Editor.Message.send("scene","set-property",r);let l=await Editor.Message.request("scene","query-node",e.value.node.value.uuid);let o=l.__comps__.findIndex((e=>"OrbitFollowTarget"==e.type));if(null==o||-1==o)return Editor.Dialog.warn("节点上面没有OrbitFollowTarget组件");const s=i.orbitParams.find((e=>e.name==n));console.assert(null!=s,n),t(l,o,"polarAngle","Number",s.polarAngle),t(l,o,"azimuthAngle","Number",s.azimuthAngle),t(l,o,"radialDistance","Number",s.radialDistance),t(l,o,"dampingFactor","Number",s.dampingFactor),t(l,o,"viewOffset","cc.Vec3",{x:s.viewOffsetX,y:s.viewOffsetY,z:s.viewOffsetZ})})),this.$.cameraDelButton.addEventListener("confirm",(()=>{const e=this.$.cameraInput.value;if(""==e)return Editor.Dialog.warn("请输入相机名称");if(null==l)return;const a=l.findIndex((a=>a.name==e));if(-1==a)return Editor.Dialog.warn("不存在该名称的相机");l.splice(a,1),Editor.Message.send("camera-params","setConfigData",i),o(l),this.$.cameraSelect.value==e&&(this.$.cameraInput.value=this.$.cameraSelect.value=u.curCameraParamName.value="")})),this.$.cameraCreateButton.addEventListener("confirm",(async()=>{const a=this.$.cameraInput.value;if(""==a)return Editor.Dialog.warn("请输入相机名称");if(l.find((e=>e.name==a)))return Editor.Dialog.warn("已经存在该名称的相机");const t=await Editor.Message.request("scene","query-node",e.value.node.value.uuid);let u=t.__comps__.findIndex((e=>"OrbitFollowTarget"==e.type));if(null==u||-1==u)return Editor.Dialog.warn("请添加OrbitFollowTarget组件");const s=await n(t,a);if(null==s)return Editor.Dialog.warn("没有可以创建的内容");null==i.orbitParams&&(i.orbitParams=[]),i.orbitParams.push(s),o(i.orbitParams),i.path=await r(t),Editor.Message.send("camera-params","setConfigData",i),this.$.cameraSelect.value=this.$.cameraInput.value})),this.$.cameraSaveButton.addEventListener("confirm",(async()=>{const a=this.$.cameraInput.value;if(""==a)return Editor.Dialog.warn("请输入相机名称");if(null==i.orbitParams)return Editor.Dialog.warn("没有可以保存的内容");const t=i.orbitParams.findIndex((e=>e.name==a));if(-1==t)return Editor.Dialog.warn("不存在该名称的相机");const l=await Editor.Message.request("scene","query-node",e.value.node.value.uuid);let u=l.__comps__.findIndex((e=>"OrbitFollowTarget"==e.type));if(null==u||-1==u)return Editor.Dialog.warn("请添加OrbitFollowTarget组件");const o=await n(l,a);if(null==o)return Editor.Dialog.warn("获取相机参数组件失败");i.orbitParams[t]=o,i.path=await r(l),Editor.Message.send("camera-params","setConfigData",i)})),this.$.adaptSaveButton.addEventListener("confirm",(async()=>{let a=await Editor.Message.request("scene","query-node",e.value.node.value.uuid);const t=a.__comps__;let n=t.findIndex((e=>"AdaptCamera"==e.type));if(null==n||-1==n)return Editor.Dialog.warn("节点上面没有AdaptCamera组件");const l=t[n].value.adaptDatas.value,u=[];for(let e of l)u.push({ratio:e.value.ratio.value,fovOffset:e.value.fovOffset.value});i.adapt={adaptDatas:u},i.path=await r(a),Editor.Message.send("camera-params","setConfigData",i),console.log("camera-params save success",i)})))},ready(){},close(){}};module.exports=Editor.Panel.define(e);